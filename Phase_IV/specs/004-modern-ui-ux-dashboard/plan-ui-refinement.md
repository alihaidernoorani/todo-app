# Implementation Plan: Dashboard UI Refinement

**Branch**: `full-stack-todo-app` | **Date**: 2026-02-08 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/004-modern-ui-ux-dashboard/spec.md` (Session 2026-02-08 clarifications)

## Summary

Refine the existing TaskFlow dashboard UI to fix three critical UX issues: metric card overflow, unresponsive task action buttons, and inconsistent typography across breakpoints. This is a frontend-only refinement that improves visual polish and interaction responsiveness without changing backend APIs or data models. **Critical requirement**: All task actions (add, update, delete, complete) MUST complete end-to-end (optimistic update + server confirmation) within **less than 3 seconds** to ensure smooth, responsive user experience. The implementation will leverage UI/UX skills and subagents to apply industry best practices for dashboard metrics, loading states, and responsive typography.

## Technical Context

**Language/Version**: TypeScript (Next.js 16+ App Router)
**Primary Dependencies**: React 19, Tailwind CSS v4, shadcn/ui, Framer Motion, Better Auth client
**Storage**: N/A (UI refinement only, uses existing backend API)
**Testing**: Visual regression testing, interaction testing for optimistic updates, performance testing for <3s task actions
**Target Platform**: Modern browsers (Chrome, Firefox, Safari, Edge - last 2 years)
**Project Type**: Web (frontend-only changes)
**Performance Goals**:
- **<100ms optimistic UI updates** (immediate visual feedback)
- **<3 seconds total task action completion** (optimistic update + server confirmation)
- **0px CLS during metric loading**
- **3-second timeout for error display** (if server exceeds 3s, show error with retry)
**Constraints**: Must maintain existing Better Auth integration, preserve API contract, no breaking changes to user workflows
**Scale/Scope**: 3 component families (MetricsGrid, TaskStream, Typography system), ~10 files modified

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

✅ **Multi-Tier Isolation**: All changes reside in `/frontend/` directory
✅ **Persistence First**: N/A (UI refinement only, no data model changes)
✅ **Secure by Design**: No changes to authentication/authorization logic
✅ **Zero Manual Coding**: All changes traceable to Claude Code via PHR
✅ **Test-First Discipline**: Visual regression and interaction tests will be added
✅ **API Contract Enforcement**: No API contract changes (UI-only refinement)

**Status**: ✅ All gates pass. No violations require justification.

## Project Structure

### Documentation (this feature)

```text
specs/004-modern-ui-ux-dashboard/
├── spec.md                  # Updated with Session 2026-02-08 clarifications
├── plan-ui-refinement.md    # This file
├── research.md              # Phase 0 output (UI/UX patterns research)
├── typography-scale.md      # Phase 1 design artifact
├── component-audit.md       # Phase 1 audit of existing components
├── performance-baseline.md  # Phase 0 current task action timing measurements
└── tasks.md                 # Will be generated by /sp.tasks
```

### Source Code (repository root)

```text
frontend/
├── app/
│   └── dashboard/
│       └── page.tsx            # Main dashboard page (typography fixes)
├── components/
│   ├── dashboard/
│   │   ├── MetricsGrid.tsx     # MODIFY: Fix overflow, grid layout
│   │   ├── MetricCard.tsx      # MODIFY: Number abbreviation, responsive layout
│   │   └── TaskStream.tsx      # MODIFY: Add loading states, optimistic updates, <3s performance
│   ├── task/
│   │   ├── TaskList.tsx        # MODIFY: Loading indicators on buttons, performance monitoring
│   │   ├── TaskItem.tsx        # MODIFY: Inline spinners, disable states, timeout handling
│   │   ├── AddTaskModal.tsx    # MODIFY: Loading state, auto-focus, <3s submission
│   │   └── TaskActions.tsx     # MODIFY: Button loading states, performance tracking
│   └── atoms/
│       ├── PrimaryButton.tsx   # MODIFY: Add loading variant
│       └── ShimmerSkeleton.tsx # VERIFY: Maintains layout structure
├── lib/
│   ├── api/
│   │   └── client.ts           # VERIFY: API client timeout configuration (<3s)
│   └── utils/
│       ├── formatNumber.ts     # CREATE: Abbreviation logic (9.9k, 999k+)
│       ├── typography.ts       # CREATE: Responsive scale utilities
│       └── performance.ts      # CREATE: Action timing monitoring utilities
└── styles/
    └── globals.css             # MODIFY: Add typography scale, spacing utilities

tests/
└── frontend/
    ├── components/
    │   ├── MetricCard.test.tsx         # CREATE: Test number abbreviation
    │   ├── TaskActions.test.tsx        # CREATE: Test loading states
    │   └── TaskActions.perf.test.tsx   # CREATE: Test <3s completion requirement
    └── visual/
        └── dashboard.visual.test.tsx   # CREATE: Visual regression
```

**Structure Decision**: Web application structure (Option 2) - frontend-only changes. All modifications confined to `/frontend/` directory per Multi-Tier Isolation principle.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

N/A - No constitution violations detected.

---

## Phase 0: Research & Discovery

**Objective**: Research UI/UX best practices, measure current performance baseline, and audit existing component implementation to identify root causes of the three problem areas.

### Performance Baseline Measurement

#### P1: Task Action Timing Audit
**Measurement Goal**: Establish current performance baseline for all task actions

**Actions**:
1. Measure current add task action: click → optimistic UI update → server confirmation
2. Measure current update task action: edit → save → confirmation
3. Measure current delete task action: click → confirmation
4. Measure current complete/uncomplete task action: toggle → update
5. Identify bottlenecks (slow API calls, missing optimistic updates, inefficient renders)
6. Document findings in `performance-baseline.md`

**Expected Findings**:
- Current task actions may exceed 3-second target
- Optimistic updates may be missing or delayed
- API client may lack timeout configuration
- No performance monitoring in place

**Deliverable**: `performance-baseline.md` with timing measurements and bottleneck analysis

### Research Tasks

#### R1: Dashboard Metric Card Best Practices
**Research Focus**: Industry standards for dashboard metric displays
- Number abbreviation patterns (k, M, B notation)
- CSS Grid responsive layouts for metric cards
- Overflow prevention techniques
- Accessibility considerations (ARIA labels for abbreviated numbers)

**Deliverable**: Document best practices in `research.md` with code examples

#### R2: High-Performance Optimistic UI Patterns
**Research Focus**: React patterns for sub-3-second responsive interactions
- `useOptimistic` hook (React 19) usage patterns for immediate feedback
- Loading state management strategies
- Button disable patterns during async operations
- Error rollback and retry UX
- **Performance optimization**: Minimize re-renders, batch state updates
- **Timeout handling**: Graceful degradation when API exceeds 3 seconds
- **Retry strategies**: Exponential backoff for failed actions

**Deliverable**: Document patterns with React 19 examples and performance benchmarks

#### R3: Responsive Typography Systems
**Research Focus**: Typography scales for multi-breakpoint layouts
- Fluid typography techniques (clamp, viewport units)
- Tailwind CSS responsive utilities best practices
- Line height and spacing ratios
- WCAG readability standards (contrast, size)

**Deliverable**: Document scale recommendations

#### R4: API Client Performance Configuration
**Research Focus**: Optimize fetch configuration for <3s target
- Timeout configuration (abort controller, fetch timeout)
- Request deduplication (prevent duplicate submissions)
- Connection keep-alive optimization
- Error handling for slow networks

**Deliverable**: Document API client best practices and configuration

### Component Audit

#### A1: MetricsGrid Component Analysis
**Audit Goal**: Identify why metric numbers overflow containers

**Actions**:
1. Read `/frontend/components/dashboard/MetricsGrid.tsx`
2. Read `/frontend/components/dashboard/MetricCard.tsx`
3. Inspect grid layout CSS (check for fixed widths, missing constraints)
4. Test with large numbers (10000+) to reproduce overflow
5. Document findings in `component-audit.md`

**Expected Findings**:
- Missing `overflow-x: hidden` on grid container
- No number abbreviation logic
- Grid may not use `minmax(160px, 1fr)` constraints
- Possible hardcoded widths preventing responsiveness

#### A2: TaskStream Interaction Analysis
**Audit Goal**: Identify why task actions feel unresponsive and measure current performance

**Actions**:
1. Read `/frontend/components/dashboard/TaskStream.tsx`
2. Read `/frontend/components/task/TaskList.tsx`
3. Read `/frontend/components/task/TaskItem.tsx`
4. Read `/frontend/components/task/TaskActions.tsx`
5. Read `/frontend/lib/api/client.ts` (API client configuration)
6. Check for `useOptimistic` hook usage
7. Check for loading state management on buttons
8. **Measure actual timing**: Add/update/delete/complete actions from click to completion
9. Test add/update/delete/complete actions and measure perceived latency
10. Document findings in `component-audit.md`

**Expected Findings**:
- `useOptimistic` may not be implemented or has bugs
- Buttons lack loading spinners during async operations
- No button disable state during processing
- Missing 3-second timeout before error display (per FR-005d)
- **Performance issues**: Actions may exceed 3-second target
- API client may lack proper timeout configuration

#### A3: Typography Consistency Analysis
**Audit Goal**: Identify typography inconsistencies across breakpoints

**Actions**:
1. Read `/frontend/styles/globals.css`
2. Audit all text elements in dashboard components
3. Check Tailwind config for custom typography scale
4. Test dashboard at 320px, 768px, 1024px, 1440px widths
5. Document all font size classes used and their breakpoint variants
6. Identify missing responsive variants (text-sm vs md:text-base patterns)
7. Document findings in `component-audit.md`

**Expected Findings**:
- Inconsistent use of responsive typography utilities
- Some components may use absolute sizes instead of responsive classes
- Missing Tailwind config for unified scale
- Line height ratios may vary inconsistently

### Research Outputs

**File**: `specs/004-modern-ui-ux-dashboard/research.md`

**Required Sections**:
1. **Number Abbreviation Decision**
   - Pattern: Use `formatNumber()` utility with k/M/B suffixes
   - Rationale: Industry standard, prevents overflow
   - Implementation: Helper function, fallback to original if < 1000

2. **Grid Layout Decision**
   - Pattern: `grid-template-columns: repeat(auto-fit, minmax(160px, 1fr))`
   - Rationale: Equal widths, responsive, prevents overflow
   - Breakpoints: 1-col mobile, 2-col tablet, 4-col desktop

3. **High-Performance Loading State Decision**
   - Pattern: Inline spinner + disabled button during async operations
   - Rationale: Clear visual feedback, prevents duplicate clicks, maintains <3s target
   - Implementation: Local state + conditional render + performance monitoring
   - **Timeout**: Abort request if exceeds 3 seconds, show error with retry

4. **Typography Scale Decision**
   - Pattern: Define fluid scale in Tailwind config, use responsive utilities consistently
   - Rationale: Unified system ensures consistency
   - Scale: Mobile (sm/base), Tablet (base/lg), Desktop (lg/xl)

5. **API Client Performance Decision**
   - Pattern: Configure fetch with 3-second timeout using AbortController
   - Rationale: Ensures <3s target, graceful degradation for slow networks
   - Implementation: Wrapper around fetch with timeout logic

**File**: `specs/004-modern-ui-ux-dashboard/component-audit.md`

**Required Sections**:
- **Metrics Display Issues**: Root cause analysis with file references
- **Task Actions Issues**: Root cause analysis with file references
- **Task Actions Performance**: Current timing measurements vs <3s target
- **Typography Issues**: Root cause analysis with file references
- **Files to Modify**: Complete list with line number references

**File**: `specs/004-modern-ui-ux-dashboard/performance-baseline.md`

**Required Sections**:
- **Current Performance Metrics**:
  - Add task: [measured time]
  - Update task: [measured time]
  - Delete task: [measured time]
  - Complete task: [measured time]
- **Bottleneck Analysis**: Identify slow points (API, render, state updates)
- **Target vs Actual**: Gap analysis for <3s requirement
- **Optimization Opportunities**: Specific improvements needed

---

## Phase 1: Design & Specifications

**Prerequisites**: `research.md`, `component-audit.md`, and `performance-baseline.md` complete

### Design Artifacts

#### D1: Typography Scale Definition
**File**: `specs/004-modern-ui-ux-dashboard/typography-scale.md`

**Content**:
```markdown
# TaskFlow Typography Scale

## Breakpoints
- Mobile: 320px - 767px
- Tablet: 768px - 1023px
- Desktop: 1024px+

## Scale (Tailwind classes)

### Headings
- H1 (Page title):
  - Mobile: text-2xl (24px)
  - Tablet: text-3xl (30px)
  - Desktop: text-4xl (36px)
  - Line height: leading-tight (1.25)
  - Font: font-serif (Playfair Display)

- H2 (Section heading):
  - Mobile: text-base (16px)
  - Tablet: text-lg (18px)
  - Desktop: text-lg (18px)
  - Line height: leading-snug (1.375)
  - Font: font-sans (Inter)

### Body Text
- Body (descriptions):
  - Mobile: text-sm (14px)
  - Tablet: text-base (16px)
  - Desktop: text-base (16px)
  - Line height: leading-normal (1.5)
  - Font: font-sans (Inter)

### Metrics
- Metric value:
  - Mobile: text-3xl (30px)
  - Tablet: text-4xl (36px)
  - Desktop: text-5xl (48px)
  - Line height: leading-none (1.0)
  - Font: font-sans font-bold (Inter Bold)

- Metric label:
  - Mobile: text-xs (12px)
  - Tablet: text-sm (14px)
  - Desktop: text-sm (14px)
  - Line height: leading-normal (1.5)
  - Font: font-sans (Inter)

### UI Elements
- Button text:
  - Mobile: text-sm (14px)
  - Tablet: text-base (16px)
  - Desktop: text-base (16px)
  - Line height: leading-none (1.0)
  - Font: font-sans font-medium (Inter Medium)

## Implementation
Use Tailwind responsive utilities:
```tsx
<h1 className="text-2xl md:text-3xl lg:text-4xl font-serif leading-tight">
  Welcome back, {userName}
</h1>
```

## Accessibility
- Minimum body text: 14px (text-sm) on mobile
- Contrast ratio: 4.5:1 minimum (WCAG AA)
- Line length: max 75 characters per line
```

#### D2: Metric Card Layout Specification
**File**: `specs/004-modern-ui-ux-dashboard/metric-card-spec.md`

**Content**:
```markdown
# Metric Card Layout Specification

## Grid Layout
- Container: CSS Grid with `minmax(160px, 1fr)`
- Gap: gap-5 (20px) tablet+, gap-4 (16px) mobile
- Overflow: `overflow-x: hidden` on container

## Responsive Behavior
- Mobile (<768px): 1 column stack
- Tablet (768px-1023px): 2 columns
- Desktop (1024px+): 4 columns (horizontal)

## Card Structure
```tsx
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-5 overflow-x-hidden">
  <MetricCard
    label="Total Tasks"
    value={totalTasks}
    icon={ListTodo}
  />
  {/* ... more cards */}
</div>
```

## Number Formatting
- Use `formatNumber()` utility
- Format rules:
  - < 1,000: Display as-is (e.g., 42)
  - 1,000-9,999: Display with k (e.g., 1.2k, 9.9k)
  - 10,000-999,999: Display with k (e.g., 10k, 999k)
  - 1,000,000+: Display with M (e.g., 1.2M)
- ARIA label: Include full number for screen readers

## Card Constraints
- Min width: 160px
- Padding: p-5 (20px) tablet+, p-4 (16px) mobile
- Text truncation: Apply `truncate` to labels if needed
- Number container: `whitespace-nowrap` to prevent wrapping
```

#### D3: High-Performance Loading State Specification
**File**: `specs/004-modern-ui-ux-dashboard/loading-states-spec.md`

**Content**:
```markdown
# High-Performance Loading States Specification

## Performance Requirement
**All task actions MUST complete within less than 3 seconds** (optimistic update + server confirmation).
- Optimistic UI update: <100ms (immediate visual feedback)
- Server confirmation: <3 seconds total
- If server exceeds 3s: Show error state with retry option

## Button Loading Variant
**Component**: `PrimaryButton.tsx`

### Props
```typescript
interface PrimaryButtonProps {
  isLoading?: boolean;
  disabled?: boolean;
  children: React.ReactNode;
  onClick?: () => void;
  // ... other props
}
```

### Behavior
- When `isLoading={true}`:
  - Display inline spinner (lucide-react `Loader2` icon with `animate-spin`)
  - Disable button (prevent clicks)
  - Replace children text with "Processing..." or keep original + spinner
  - Maintain button width (prevent layout shift)

### Visual Design
```tsx
<button
  disabled={isLoading || disabled}
  className="relative"
>
  {isLoading && (
    <Loader2 className="absolute left-1/2 -translate-x-1/2 animate-spin h-4 w-4" />
  )}
  <span className={isLoading ? "opacity-0" : ""}>
    {children}
  </span>
</button>
```

## Task Action Performance Monitoring
**Components**: `TaskActions.tsx`, `TaskItem.tsx`, `TaskStream.tsx`

### Performance Tracking Utility
```typescript
// lib/utils/performance.ts
export const trackActionTiming = (actionName: string) => {
  const startTime = performance.now();

  return {
    complete: () => {
      const duration = performance.now() - startTime;
      console.log(`[Performance] ${actionName}: ${duration}ms`);

      if (duration > 3000) {
        console.warn(`[Performance] ${actionName} exceeded 3s target: ${duration}ms`);
      }

      return duration;
    }
  };
};
```

### State Management with Performance Tracking
```typescript
const [loadingAction, setLoadingAction] = useState<'complete' | 'delete' | null>(null);

const handleComplete = async () => {
  const tracker = trackActionTiming('complete-task');
  setLoadingAction('complete');

  try {
    await completeTask(task.id);
    const duration = tracker.complete();

    // Success feedback
  } catch (error) {
    // Error handling
  } finally {
    setLoadingAction(null);
  }
};
```

### 3-Second Timeout Logic (FR-005d)
```typescript
const [showError, setShowError] = useState(false);
const [timeoutError, setTimeoutError] = useState(false);

useEffect(() => {
  if (loadingAction) {
    const timer = setTimeout(() => {
      if (loadingAction) {
        setShowError(true);
        setTimeoutError(true);
      }
    }, 3000); // 3 seconds per FR-005d and <3s requirement

    return () => clearTimeout(timer);
  }
}, [loadingAction]);
```

## API Client Timeout Configuration
**File**: `/frontend/lib/api/client.ts`

### Fetch with AbortController
```typescript
export const apiClientWithTimeout = async (
  url: string,
  options: RequestInit = {},
  timeoutMs: number = 3000 // 3-second default
) => {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), timeoutMs);

  try {
    const response = await fetch(url, {
      ...options,
      signal: controller.signal,
    });
    clearTimeout(timeoutId);
    return response;
  } catch (error) {
    clearTimeout(timeoutId);
    if (error.name === 'AbortError') {
      throw new Error('Request timeout: Server did not respond within 3 seconds');
    }
    throw error;
  }
};
```

## Optimistic Updates with Performance
**Component**: `TaskStream.tsx`

### useOptimistic Implementation
```typescript
import { useOptimistic } from 'react';

const [optimisticTasks, addOptimisticTask] = useOptimistic(
  tasks,
  (state, newTask) => [...state, newTask]
);

const handleAddTask = async (taskData) => {
  const tracker = trackActionTiming('add-task');

  // Optimistically add task (<100ms target)
  const tempTask = { ...taskData, id: `temp-${Date.now()}`, isPending: true };
  addOptimisticTask(tempTask);

  try {
    // Server confirmation (<3s total target)
    const result = await apiClientWithTimeout('/tasks', {
      method: 'POST',
      body: JSON.stringify(taskData),
    }, 3000);

    const duration = tracker.complete();

    if (duration < 3000) {
      // Success within target
    } else {
      // Log warning but don't fail
      console.warn('Task creation exceeded 3s target');
    }
  } catch (error) {
    // Rollback handled by React, show error UI
    setError(error.message);
    tracker.complete();
  }
};
```

## Error States for Slow Actions
When action exceeds 3 seconds:
1. **Optimistic update remains visible** (don't remove it immediately)
2. **Show inline error message**: "This is taking longer than expected. Please wait or try again."
3. **Provide retry button**: Allow user to retry the action
4. **Timeout after 10 seconds**: If no response after 10s, show failure and rollback

```typescript
const [actionPhase, setActionPhase] = useState<'idle' | 'optimistic' | 'slow' | 'error'>('idle');

useEffect(() => {
  if (actionPhase === 'optimistic') {
    const slowTimer = setTimeout(() => {
      setActionPhase('slow');
      // Show "Taking longer than expected" message
    }, 3000);

    const failTimer = setTimeout(() => {
      setActionPhase('error');
      // Show error and rollback
    }, 10000);

    return () => {
      clearTimeout(slowTimer);
      clearTimeout(failTimer);
    };
  }
}, [actionPhase]);
```
```

#### D4: Performance Testing Specification
**File**: `specs/004-modern-ui-ux-dashboard/performance-testing-spec.md`

**Content**:
```markdown
# Performance Testing Specification

## Test Requirements
All task actions MUST be tested for <3-second completion time.

## Performance Test Cases

### Test 1: Add Task Performance
```typescript
test('Add task completes within 3 seconds', async () => {
  const startTime = performance.now();

  // Trigger add task
  await user.click(addButton);
  await user.type(titleInput, 'New Task');
  await user.click(submitButton);

  // Wait for server confirmation
  await waitFor(() => {
    expect(screen.getByText('New Task')).toBeInTheDocument();
  });

  const duration = performance.now() - startTime;
  expect(duration).toBeLessThan(3000);
});
```

### Test 2: Complete Task Performance
```typescript
test('Complete task updates within 3 seconds', async () => {
  const startTime = performance.now();

  await user.click(completeCheckbox);

  await waitFor(() => {
    expect(completeCheckbox).toBeChecked();
  });

  const duration = performance.now() - startTime;
  expect(duration).toBeLessThan(3000);
});
```

### Test 3: Delete Task Performance
```typescript
test('Delete task removes item within 3 seconds', async () => {
  const startTime = performance.now();

  await user.click(deleteButton);

  await waitFor(() => {
    expect(screen.queryByText('Task to delete')).not.toBeInTheDocument();
  });

  const duration = performance.now() - startTime;
  expect(duration).toBeLessThan(3000);
});
```

### Test 4: Update Task Performance
```typescript
test('Update task saves within 3 seconds', async () => {
  const startTime = performance.now();

  await user.click(editButton);
  await user.clear(titleInput);
  await user.type(titleInput, 'Updated Task');
  await user.click(saveButton);

  await waitFor(() => {
    expect(screen.getByText('Updated Task')).toBeInTheDocument();
  });

  const duration = performance.now() - startTime;
  expect(duration).toBeLessThan(3000);
});
```

## Performance Monitoring in Production
```typescript
// Add performance observer
const observer = new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    if (entry.duration > 3000) {
      // Log slow actions for monitoring
      console.warn(`Slow action detected: ${entry.name} (${entry.duration}ms)`);
    }
  }
});

observer.observe({ entryTypes: ['measure'] });
```
```

### Agent Context Update

After completing design artifacts, update agent context:

**Action**: Run agent context update script (if available) or manually update `.specify/memory/intelligence.md` with:
- Typography scale reference
- Grid layout patterns
- High-performance loading state patterns
- Number abbreviation utility
- **Performance monitoring utilities**
- **<3-second completion requirement for all task actions**

---

## Phase 2: Component Implementation Plan

**Prerequisites**: All Phase 1 design artifacts complete

### Implementation Waves

#### Wave 1: Utility Functions & Base Components
**Goal**: Create reusable utilities and update base button component

**Performance Target**: Utilities should add <10ms overhead

**Tasks**:
1. **Create `formatNumber()` utility**
   - File: `/frontend/lib/utils/formatNumber.ts`
   - Logic: Implement k/M abbreviation with threshold checks
   - Performance: <1ms execution time
   - Tests: Unit tests for edge cases (0, 999, 1000, 9999, 1M)

2. **Create performance tracking utilities**
   - File: `/frontend/lib/utils/performance.ts`
   - Logic: `trackActionTiming()` for monitoring action duration
   - Performance: Minimal overhead (<5ms)
   - Tests: Verify accurate timing measurements

3. **Create typography utilities**
   - File: `/frontend/lib/utils/typography.ts`
   - Export responsive class generators (optional, may inline in components)

4. **Update API client with timeout**
   - File: `/frontend/lib/api/client.ts`
   - Add: `apiClientWithTimeout()` wrapper with AbortController
   - Timeout: 3 seconds default
   - Tests: Verify timeout triggers at 3s

5. **Update `PrimaryButton` component**
   - File: `/frontend/components/atoms/PrimaryButton.tsx`
   - Add `isLoading` prop
   - Implement spinner + disabled state
   - Maintain layout (prevent shift)
   - Performance: No impact on render time

**Acceptance**:
- `formatNumber(1234)` returns "1.2k" in <1ms
- `formatNumber(999)` returns "999"
- `trackActionTiming()` accurately measures duration
- API client aborts requests after 3 seconds
- `PrimaryButton` with `isLoading={true}` shows spinner and is disabled

#### Wave 2: Metrics Display Fix
**Goal**: Fix metric card overflow and responsive grid

**Performance Target**: No CLS (Cumulative Layout Shift)

**Tasks**:
1. **Update `MetricsGrid` component**
   - File: `/frontend/components/dashboard/MetricsGrid.tsx`
   - Change grid to: `grid-cols-1 md:grid-cols-2 lg:grid-cols-4`
   - Add `overflow-x-hidden`
   - Update gap: `gap-4 md:gap-5`
   - Performance: Stable layout, 0px CLS

2. **Update `MetricCard` component**
   - File: `/frontend/components/dashboard/MetricCard.tsx`
   - Import and use `formatNumber()` for value display
   - Add ARIA label with full number
   - Update metric value typography: `text-3xl md:text-4xl lg:text-5xl`
   - Update label typography: `text-xs md:text-sm`
   - Add `whitespace-nowrap` to number container
   - Performance: <1ms formatting overhead

**Acceptance**:
- Metrics display in 1/2/4 columns at mobile/tablet/desktop
- Large numbers show as "9.9k" instead of overflowing
- Screen readers announce full number
- 0px CLS during metric loading

#### Wave 3: High-Performance Task Action Implementation
**Goal**: Add loading states and ensure <3-second completion for all task actions

**Performance Target**: <100ms optimistic update, <3 seconds total completion

**Tasks**:
1. **Update `TaskStream` component**
   - File: `/frontend/components/dashboard/TaskStream.tsx`
   - Implement `useOptimistic` hook for task list
   - Add error state management
   - Add 3-second timeout logic (FR-005d)
   - Add performance tracking for all actions
   - **Critical**: Ensure optimistic update happens within 100ms
   - **Critical**: Ensure total action completes within 3 seconds

2. **Update `TaskList` component**
   - File: `/frontend/components/task/TaskList.tsx`
   - Pass loading states down to TaskItem
   - Add performance monitoring wrapper

3. **Update `TaskItem` component**
   - File: `/frontend/components/task/TaskItem.tsx`
   - Add local `loadingAction` state
   - Update complete button to use `PrimaryButton` with `isLoading`
   - Update delete button to use `PrimaryButton` with `isLoading`
   - Add performance tracking: `trackActionTiming('complete-task')`
   - Add timeout handling: Show error if >3s
   - **Optimize**: Prevent unnecessary re-renders during loading state

4. **Update `TaskActions` component**
   - File: `/frontend/components/task/TaskActions.tsx`
   - Add loading state to edit/update actions
   - Prevent duplicate clicks during processing
   - Add performance tracking
   - **Optimize**: Debounce rapid clicks

5. **Update `AddTaskModal` component**
   - File: `/frontend/components/task/AddTaskModal.tsx`
   - Add `isSubmitting` state
   - Use `PrimaryButton` with `isLoading` for submit button
   - Implement auto-focus on title field (FR-005b)
   - Add performance tracking
   - **Optimize**: Validate input before submission to avoid wasted API calls

6. **Create performance tests**
   - File: `/frontend/tests/components/TaskActions.perf.test.tsx`
   - Test: Add task completes within 3 seconds
   - Test: Update task completes within 3 seconds
   - Test: Delete task completes within 3 seconds
   - Test: Complete task completes within 3 seconds
   - Test: Optimistic updates appear within 100ms

**Acceptance**:
- Clicking "Complete" shows inline spinner on that specific button within 100ms
- Button is disabled during processing
- UI updates optimistically (task appears immediately, <100ms)
- **Server confirmation received within 3 seconds total**
- Errors appear after 3 seconds with retry button if server doesn't respond
- No duplicate submissions possible
- All performance tests pass (<3s requirement)

#### Wave 4: Typography Consistency
**Goal**: Apply responsive typography scale across all dashboard components

**Performance Target**: No impact on render performance

**Tasks**:
1. **Update dashboard page**
   - File: `/frontend/app/dashboard/page.tsx`
   - Update welcome heading: `text-2xl md:text-3xl lg:text-4xl font-serif`
   - Update description: `text-sm md:text-base`
   - Update section headings: `text-base md:text-lg`

2. **Audit and update all text elements**
   - MetricsGrid section heading
   - TaskStream section heading
   - Task titles in TaskItem
   - Button text sizes
   - Modal headings and labels

3. **Update global CSS (if needed)**
   - File: `/frontend/styles/globals.css`
   - Add any missing font family definitions
   - Ensure Playfair Display loaded for serif headings

**Acceptance**:
- All text elements follow typography scale
- Font sizes adapt correctly at 320px, 768px, 1024px widths
- Serif font used for page titles, sans-serif for UI
- No performance degradation from typography changes

#### Wave 5: Visual Testing, Performance Validation & Polish
**Goal**: Verify visual consistency, interaction smoothness, and performance compliance

**Performance Target**: All actions meet <3s requirement in real-world testing

**Tasks**:
1. **Visual regression testing**
   - Create baseline screenshots at multiple breakpoints
   - Test metric cards with various number sizes
   - Test loading states

2. **Interaction testing**
   - Test add/update/delete/complete actions
   - Verify optimistic updates (<100ms)
   - Test error rollback scenarios
   - Verify 3-second error timeout

3. **Performance validation**
   - **Run all performance tests**: Verify <3s completion for all actions
   - **Test on slow networks**: Verify timeout handling works correctly
   - **Test rapid actions**: Verify no race conditions or duplicate submissions
   - **Measure real-world performance**: Use browser DevTools to validate timing
   - **Load testing**: Test with many tasks (100+) to ensure performance scales

4. **Accessibility audit**
   - Check ARIA labels on abbreviated numbers
   - Verify keyboard navigation
   - Test with screen reader

5. **Cross-browser testing**
   - Test in Chrome, Firefox, Safari, Edge
   - Verify performance consistency across browsers

**Acceptance**:
- No visual regressions detected
- All interactions feel responsive (<100ms perceived latency)
- **All task actions complete within 3 seconds (measured)**
- Timeout handling works correctly when server is slow
- No race conditions or duplicate submissions
- Accessibility standards met (WCAG AA)
- Consistent behavior across browsers

---

## Skill & Subagent Invocation Points

### Research Phase (Phase 0)
- **Invoke**: `ui-ux-futuristic-designer` skill to review best practices for dashboard metrics
- **Invoke**: `Explore` subagent to audit existing component structure and identify files to modify
- **Invoke**: `Explore` subagent to measure current performance baseline for task actions

### Design Phase (Phase 1)
- **Invoke**: `schema-designer` subagent (if needed) to validate component prop interfaces
- **Invoke**: `ui-structure-architect` subagent to verify responsive layout patterns

### Implementation Phase (Phase 2)
- **Invoke**: `ui-interaction-designer` subagent to implement high-performance loading states and optimistic updates
- **Invoke**: `ui-ux-futuristic-designer` skill for final polish and visual consistency review
- **Invoke**: `query-scope-enforcer` subagent to ensure API client timeout configuration is correct

---

## Success Criteria (from Spec + Performance Requirements)

**Metric Display** (FR-004b, FR-004c):
- ✅ Numbers abbreviated when > 999 (9.9k notation)
- ✅ Grid uses minmax(160px, 1fr) constraints
- ✅ Responsive: 1-col mobile, 2-col tablet, 4-col desktop
- ✅ No overflow from grid container

**Task Actions - Functionality** (FR-005c, FR-005d):
- ✅ Inline spinner appears on clicked button
- ✅ Button disabled during processing
- ✅ Optimistic UI updates (<100ms perceived latency)
- ✅ Error display after 3-second timeout
- ✅ Retry button on error state

**Task Actions - Performance** (Critical Requirement):
- ✅ **Add task completes within <3 seconds** (optimistic update + server confirmation)
- ✅ **Update task completes within <3 seconds**
- ✅ **Delete task completes within <3 seconds**
- ✅ **Complete/uncomplete task completes within <3 seconds**
- ✅ **Optimistic UI update appears within <100ms**
- ✅ **API client configured with 3-second timeout**
- ✅ **Graceful error handling when server exceeds 3 seconds**

**Typography** (FR-009b):
- ✅ Consistent scale across all components
- ✅ Responsive sizes adapt at breakpoints
- ✅ Readable on all devices (WCAG AA compliance)

**Performance** (from Success Criteria):
- ✅ SC-002: Task creation appears within 100ms (optimistic)
- ✅ **SC-002 Extended: Task creation completes within <3 seconds total**
- ✅ SC-003: 0px CLS during metric loading
- ✅ SC-010: 90% of users complete actions on first attempt

---

## Risk Analysis

### Risk 1: useOptimistic Hook Performance
**Impact**: High
**Likelihood**: Medium
**Mitigation**:
- Profile `useOptimistic` hook to ensure <100ms update
- Test with large task lists (100+ items)
- Implement memoization if performance degrades

### Risk 2: Backend API Response Time
**Impact**: High
**Likelihood**: Medium
**Mitigation**:
- **Configure API client with 3-second timeout**
- **Implement graceful degradation** when API is slow
- **Add retry logic** for failed requests
- **Monitor backend performance** separately (may need backend optimization)

### Risk 3: Network Latency Variability
**Impact**: Medium
**Likelihood**: High
**Mitigation**:
- Optimistic updates ensure perceived performance
- Clear feedback when actions exceed 3 seconds
- Retry mechanism for failed actions
- Test on throttled networks (3G, slow 4G)

### Risk 4: Number Abbreviation Accessibility
**Impact**: Medium
**Likelihood**: Low
**Mitigation**: Always include ARIA labels with full numbers, test with screen readers

### Risk 5: CSS Grid Browser Support
**Impact**: Low
**Likelihood**: Very Low
**Mitigation**: Target modern browsers only (last 2 years), well-supported feature

### Risk 6: Race Conditions in Rapid Actions
**Impact**: High
**Likelihood**: Medium
**Mitigation**:
- Disable buttons during processing
- Debounce rapid clicks
- Request deduplication in API client
- Comprehensive testing of rapid interactions

---

## Next Steps

1. **Execute Phase 0**: Run research tasks, performance baseline measurement, and component audit
2. **Execute Phase 1**: Create design artifacts (typography scale, layout specs, high-performance loading states, performance testing spec)
3. **Generate Tasks**: Run `/sp.tasks` to create actionable implementation tasks from this plan
4. **Execute Implementation**: Run `/sp.implement` to execute tasks in dependency order
5. **Performance Validation**: Run performance tests to verify <3-second requirement

**Command to proceed**: `/sp.tasks`

---

## Performance Monitoring & Metrics

### Key Performance Indicators (KPIs)
- **Optimistic Update Time**: <100ms (target: 50ms)
- **Add Task Total Time**: <3 seconds (target: 1-2 seconds)
- **Update Task Total Time**: <3 seconds (target: 1-2 seconds)
- **Delete Task Total Time**: <3 seconds (target: 1-2 seconds)
- **Complete Task Total Time**: <3 seconds (target: 1-2 seconds)
- **API Timeout Rate**: <5% of requests
- **User Retry Rate**: <10% of actions

### Monitoring Implementation
```typescript
// Track all task actions
const performanceMetrics = {
  addTask: [],
  updateTask: [],
  deleteTask: [],
  completeTask: [],
};

// Log to console in development, send to analytics in production
const logPerformance = (action: string, duration: number) => {
  performanceMetrics[action].push(duration);

  if (duration > 3000) {
    console.error(`[Performance] ${action} exceeded 3s: ${duration}ms`);
  } else {
    console.log(`[Performance] ${action}: ${duration}ms`);
  }
};
```
